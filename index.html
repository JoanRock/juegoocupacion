<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego de Ocupación</title>
  <style>
    :root {
      --bg-page: #2c3e50;
      --board-bg: #ecf0f1;
      --cell-light: #ffffff;
      --cell-dark: #bdc3c7;
      --highlight: #f1c40f;
      --players: #e74c3c, #27ae60, #3498db, #f39c12;
      --shadow: rgba(0,0,0,0.2);
      --token-size: 70%;
      --dot-size: 20%;
      --transition: 0.2s;
      --font: 'Montserrat', sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--bg-page);
      font-family: var(--font);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px var(--shadow);
    }
    #status, #scores {
      background: var(--board-bg);
      color: #2c3e50;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px var(--shadow);
      margin: 10px;
      width: fit-content;
    }
    #scores {
      display: flex;
      gap: 15px;
    }
    .score {
      display: flex;
      align-items: center;
      font-weight: bold;
    }
    .score .dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-right: 6px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(8, 60px);
      grid-template-rows: repeat(8, 60px);
      gap: 4px;
      background: var(--board-bg);
      padding: 12px;
      border-radius: 16px;
      box-shadow: 0 6px 12px var(--shadow);
    }
    .cell {
      position: relative;
      width: 60px;
      height: 60px;
      background: var(--cell-light);
      cursor: pointer;
      transition: transform var(--transition), background var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }
    .cell.dark { background: var(--cell-dark); }
    .cell:hover { transform: scale(1.05); background: var(--highlight); }
    .trail {
      position: absolute;
      width: var(--dot-size);
      height: var(--dot-size);
      border-radius: 50%;
      opacity: 0.9;
    }
    .token {
      font-size: var(--token-size);
      transition: transform var(--transition);
    }
    .cell.token-0 .token:hover,
    .cell.token-1 .token:hover,
    .cell.token-2 .token:hover,
    .cell.token-3 .token:hover {
      transform: scale(1.2);
    }
    .cell.trail-0 .trail { background: rgba(231, 76, 60, 0.8); }
    .cell.trail-1 .trail { background: rgba(39, 174, 96, 0.8); }
    .cell.trail-2 .trail { background: rgba(52, 152, 219, 0.8); }
    .cell.trail-3 .trail { background: rgba(243, 156, 18, 0.8); }
    .cell.token-0 .token { color: #e74c3c; }
    .cell.token-1 .token { color: #27ae60; }
    .cell.token-2 .token { color: #3498db; }
    .cell.token-3 .token { color: #f39c12; }
  </style>
</head>
<body>
  <h1>Juego de Ocupación</h1>
  <div id="status">Cargando...</div>
  <div id="scores"></div>
  <div id="board"></div>
  <script>
    const size = 8;
    const center = new Set(["3,3","3,4","4,3","4,4"]);
    let board = [], tokens = [], currentPlayer = 0, alive = [true, true, true, true];

    function init() {
      board = Array(size).fill().map(() => Array(size).fill(null));
      tokens = [{r:0,c:0},{r:0,c:7},{r:7,c:7},{r:7,c:0}];
      tokens.forEach((t,i) => board[t.r][t.c] = {type:'token',player:i});
      render(); updateScores(); updateStatus();
    }

    function render() {
      const B = document.getElementById('board'); B.innerHTML = '';
      for (let r=0; r<size; r++) for (let c=0; c<size; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell ' + ((r+c)%2? 'dark':'');
        const item = board[r][c];
        if (item) {
          if (item.type==='trail') {
            const dot = document.createElement('div');
            dot.className = 'trail';
            dot.style.background = getTrailColor(item.player);
            cell.append(dot);
          }
          if (item.type==='token') {
            const icon = document.createElement('span');
            icon.className = 'token'; icon.textContent='♟';
            icon.style.color = getPlayerColor(item.player);
            cell.append(icon);
          }
        }
        cell.addEventListener('click', ()=>move(r,c));
        B.append(cell);
      }
    }

    function move(r,c) {
      const t = tokens[currentPlayer];
      const dr = Math.abs(r - t.r), dc = Math.abs(c - t.c);
      let ok = (dr + dc === 1) || (dr === 1 && dc === 1);
      if (center.has(`${t.r},${t.c}`) && (r===0||r===7||c===0||c===7)) ok=true;
      if (!ok || !alive[currentPlayer]) return;

      // No moverse a una celda ocupada por otra ficha propia
      const target = board[r][c];
      if (target && target.type === 'token') {
        if (target.player === currentPlayer) return;
        alive[target.player] = false; // eliminar jugador
      }

      board[t.r][t.c] = {type:'trail', player:currentPlayer};
      tokens[currentPlayer] = {r, c};
      board[r][c] = {type:'token', player:currentPlayer};
      checkTrapped();
      nextPlayer();
      render();
      updateScores();
      updateStatus();
    }

    function checkTrapped() {
      const dirs = [[1,0],[-1,0],[0,1],[0,-1]];
      tokens.forEach((t,i)=>{
        if (!alive[i]) return;
        const trapped = dirs.every(([dr,dc])=>{
          const nr=t.r+dr,nc=t.c+dc;
          if(nr<0||nr>=size||nc<0||nc>=size) return false;
          const n=board[nr][nc]; return n && ((n.type==='trail'&&n.player===i)||n.type==='token');
        }); if (trapped) alive[i]=false;
      });
    }

    function nextPlayer() {
      for (let i=1; i<=4; i++) {
        const p = (currentPlayer + i) % 4;
        if (alive[p]) {
          currentPlayer = p;
          return;
        }
      }
    }

    function updateScores() {
      const sc = [0,0,0,0];
      board.flat().forEach(c => { if (c?.type==='trail') sc[c.player]++; });
      const S = document.getElementById('scores'); S.innerHTML='';
      sc.forEach((v,i) => {
        const div = document.createElement('div'); div.className='score';
        const dot=document.createElement('div'); dot.className='dot'; dot.style.background=getPlayerColor(i);
        div.append(dot,`Jugador ${i+1}: ${v}`);
        S.append(div);
      });
    }

    function updateStatus() {
      const full = board.flat().every(c=>c);
      const aliveCount = alive.filter(a=>a).length;
      const st = document.getElementById('status');
      if (full || aliveCount <= 1) {
        const scores = [0,0,0,0];
        board.flat().forEach(c=>{ if(c?.type==='trail') scores[c.player]++; });
        const max = Math.max(...scores);
        const winners = scores.map((s,i)=>s===max?i:null).filter(i=>i!==null);
        st.textContent = winners.length>1 ? `Empate entre jugadores ${winners.map(i=>i+1).join(', ')}` : `Ganador: Jugador ${winners[0]+1}`;
      } else {
        st.textContent = `Turno del Jugador ${currentPlayer+1}`;
      }
    }

    function getPlayerColor(i) {
      return ["#e74c3c","#27ae60","#3498db","#f39c12"][i];
    }
    function getTrailColor(i) {
      return getPlayerColor(i) + "cc";
    }

    init();
  </script>
</body>
</html>
